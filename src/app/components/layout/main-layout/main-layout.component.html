<div class="d-flex" id="wrapper" [class.toggled]="isSidebarCollapsed">
    <!-- Sidebar -->
    <div class="bg-white border-end position-relative d-flex flex-column" id="sidebar-wrapper">
        <!-- Logo Section -->
        <div class="sidebar-heading text-center pt-4 pb-3">
            <div class="d-flex align-items-center justify-content-center gap-2 mb-2">
                <div class="logo-box bg-primary rounded-3 d-flex align-items-center justify-content-center shadow-sm text-white"
                    style="width: 48px; height: 48px;">
                    <i class="bi bi-kanban fs-3"></i>
                </div>
                <!-- Hide text when collapsed -->
                <h4 class="fw-bolder text-dark m-0 tracking-tight logo-text" *ngIf="!isSidebarCollapsed">PMS</h4>
            </div>
        </div>

        <!-- Navigation Links -->
        <div class="list-group list-group-flush my-3 px-3 flex-grow-1">
            <a routerLink="/dashboard" routerLinkActive="active"
                class="list-group-item list-group-item-action bg-transparent rounded-3 border-0 mb-2 d-flex align-items-center gap-3 py-3"
                title="Dashboard">
                <div class="icon-wrapper text-center" style="width: 24px;">
                    <i class="bi bi-grid-fill fs-5"></i>
                </div>
                <span class="fw-bold nav-text" *ngIf="!isSidebarCollapsed">Dashboard</span>
            </a>

            <a *appHasRole="['Admin', 'Manager', 'Employee']" routerLink="/projects" routerLinkActive="active"
                class="list-group-item list-group-item-action bg-transparent rounded-3 border-0 mb-2 d-flex align-items-center gap-3 py-3"
                title="Projects">
                <div class="icon-wrapper text-center" style="width: 24px;">
                    <i class="bi bi-layers-fill fs-5 text-danger"></i>
                </div>
                <span class="fw-bold nav-text" *ngIf="!isSidebarCollapsed">Projects</span>
            </a>

            <!-- Placeholder for My Jobs/Tasks if needed, referencing the 'Stack' icon from user image -->
            <!-- Using Dashboard for now or just generic link if no route exists -->

            <a *appHasRole="['Admin']" routerLink="/users" routerLinkActive="active"
                class="list-group-item list-group-item-action bg-transparent rounded-3 border-0 mb-2 d-flex align-items-center gap-3 py-3"
                title="Users">
                <div class="icon-wrapper text-center" style="width: 24px;">
                    <i class="bi bi-people-fill fs-5 text-secondary"></i>
                </div>
                <span class="fw-bold nav-text" *ngIf="!isSidebarCollapsed">Users</span>
            </a>
        </div>

        <!-- Bottom Profile Section -->
        <div class="sidebar-footer border-top mt-auto p-3" *ngIf="user$ | async as user">
            <button
                class="profile-btn w-100 d-flex align-items-center p-2 rounded-3 border-0 bg-transparent text-start ripple-effect"
                [matMenuTriggerFor]="userMenu">

                <!-- Avatar -->
                <div class="avatar-wrapper position-relative">
                    <div class="avatar-box rounded-circle d-flex align-items-center justify-content-center text-white fw-bold shadow-sm"
                        style="width: 40px; height: 40px;">
                        {{ user.fullName ? user.fullName.charAt(0).toUpperCase() : 'U' }}
                    </div>
                    <span class="position-absolute bottom-0 end-0 p-1 bg-success border border-white rounded-circle"
                        style="transform: translate(-2px, -2px); width: 10px; height: 10px; display: block;">
                    </span>
                </div>

                <!-- Text Info -->
                <div class="profile-info ms-3 overflow-hidden flex-grow-1" *ngIf="!isSidebarCollapsed">
                    <div class="fw-bold text-dark text-truncate" style="font-size: 0.9rem; letter-spacing: -0.01em;">
                        {{ user.fullName }}
                    </div>
                    <div class="text-muted small text-truncate" style="font-size: 0.75rem; letter-spacing: 0.01em;">
                        {{ user.role }}
                    </div>
                </div>

                <!-- Icons -->
                <i class="bi bi-chevron-up ms-2 text-secondary opacity-50" *ngIf="!isSidebarCollapsed"
                    style="font-size: 0.85rem;"></i>
            </button>

            <mat-menu #userMenu="matMenu" xPosition="after" yPosition="above"
                class="rounded-4 mt-2 shadow-lg border profile-menu-custom">
                <div class="px-3 py-2 border-bottom mb-1" *ngIf="!isSidebarCollapsed">
                    <div class="fw-bold text-dark">{{ user.fullName }}</div>
                    <div class="text-muted small">{{ user.email }}</div>
                </div>
                <!-- <button mat-menu-item class="rounded-2 mx-1 my-1" style="min-width: 180px;">
                    <mat-icon class="text-secondary">badge</mat-icon>
                    <span>My Profile</span>
                </button>
                <button mat-menu-item class="rounded-2 mx-1 my-1">
                    <mat-icon class="text-secondary">settings</mat-icon>
                    <span>Settings</span>
                </button> -->
                <div class="dropdown-divider my-1"></div>
                <button mat-menu-item (click)="logout()" class="rounded-2 mx-1 my-1 text-danger">
                    <mat-icon class="text-danger">logout</mat-icon>
                    <span>Sign Out</span>
                </button>
            </mat-menu>
        </div>

        <!-- Toggle Button (Floating) -->
        <button
            class="btn btn-white shadow-sm rounded-circle position-absolute top-50 start-100 translate-middle border d-flex align-items-center justify-content-center toggle-btn"
            style="width: 32px; height: 32px; z-index: 100;" (click)="toggleSidebar()">
            <i class="bi" [class.bi-chevron-left]="!isSidebarCollapsed"
                [class.bi-chevron-right]="isSidebarCollapsed"></i>
        </button>
    </div>

    <!-- Page Content -->
    <div id="page-content-wrapper" class="bg-light">
        <!-- Navbar (Minimized, mostly for title/mobile toggle if needed) -->
        <nav class="navbar navbar-expand-lg navbar-light bg-transparent py-4 px-4 border-bottom d-none d-lg-flex">
            <div class="d-flex align-items-center">
                <h2 class="fs-2 m-0 text-dark fw-bold">Dashboard</h2>
            </div>
        </nav>

        <div class="container-fluid px-4 py-3">
            <router-outlet></router-outlet>
        </div>
    </div>
</div>